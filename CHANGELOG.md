# CHANGELOG

All notable changes to this project will be documented here.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

---

## [Unreleased]

---

## [v0.2.1] - 2026-01-16 (Docker & 体验优化)

### 🐳 部署与运维
- **Docker 化**：提供了完整的 `Dockerfile` 和 `docker-compose.yml`，支持一键启动前后端。
- **环境自适应**：前端智能判断开发环境（直连后端）与生产环境（Nginx 代理），无需手动修改代码即可部署。
- **Nginx 集成**：前端容器内置 Nginx，处理静态资源服务与 API 反向代理。

### 🎨 UI/UX 优化
- **首页布局**：紧凑化设计，拉近了 Logo 与输入框的距离，提升视觉凝聚力。
- **视觉增强**：
    - 聊天输入框在非激活状态下边框加深，边界更清晰。
    - 聊天顶部栏高度收窄，并增加了精致的毛玻璃 (Backdrop Blur) 吸顶效果。
    - 首页“我的智能体”切换时增加滚动条预留空间，彻底解决了页面抖动问题。
- **交互细节**：
    - 侧边栏头像菜单加宽，改为长方形布局，更符合桌面端操作习惯。
    - 修复了从首页跳转到对话页时，首条消息可能不显示的 Race Condition 问题。

### 🐛 核心修复
- **后端异步调用**：修复了 FastAPI 与 LangGraph 结合时，因同步调用异步节点导致的 `500 Internal Server Error`。
- **CORS 策略**：完善了跨域资源共享配置，确保本地开发与容器通信畅通。
- **数据关联**：修复了获取会话详情时，后端未加载关联消息 (Lazy Loading) 导致历史记录空白的问题。

---

## [v0.2.0] - 2026-01-16 (架构升级版)

本次更新是一次重大的架构升级，全面提升了系统的稳定性、可维护性和数据安全性。

### 🚀 架构升级 (Backend)
- **技术栈迁移**：从 Node.js (Express) 迁移至 **Python (FastAPI)**，充分利用 Python 在 AI 领域的生态优势。
- **LangGraph Python**：重写了智能体工作流 (`graph.py`)，逻辑与原 TS 版保持一致，但更易于扩展。
- **数据持久化**：
    - 引入 **SQLModel (SQLite)** 作为数据库。
    - 实现了 `Conversation` 和 `Message` 的持久化存储。
    - 告别了不可靠的 LocalStorage 存储方案，数据云端（数据库）同步。
- **API 增强**：
    - 新增 RESTful 接口：`GET /conversations` (列表), `GET /conversations/{id}` (详情), `DELETE` (删除)。
    - 实现了更健壮的 **SSE (Server-Sent Events)** 流式输出。

### ⚡️ 前端重构 (Frontend)
- **状态管理**：引入 **Zustand** (`chatStore.ts`) 替代 React Context/State，解决了 Prop Drilling 问题。
- **路由系统**：引入 **React Router** (`react-router-dom`)。
    - 支持通过 URL (`/chat/:id`) 直接访问特定会话。
    - 实现了 `HomePage`, `ChatPage`, `HistoryPage` 的组件解耦。
- **逻辑抽离**：创建自定义 Hook `useChat.ts`，将复杂的发送/接收/流处理逻辑从 UI 组件中剥离。
- **体验优化**：
    - 自动保存会话：发送第一条消息时自动创建会话并更新 URL。
    - 历史记录：从后端实时拉取，支持按时间排序和删除。

### 🐛 修复
- 修复了刷新页面导致聊天记录丢失的问题（得益于数据库集成）。
- 修复了 URL 状态与当前会话不一致的问题。
- 修复了大量 TypeScript 类型定义错误 (`any` 类型减少)。
- 移除了未使用的代码和依赖，减小了包体积。

---

## [v0.1.1] - 2026-01-15 (晚间)

### 新增功能
- **自定义智能体**：实现了用户创建、保存自定义 AI 智能体的完整流程
- **智能体管理**：首页新增 Tab 切换（"精选智能体" vs "我创建的"）
- **真实流式输出**：后端重构为基于 LangGraph `streamEvents` 的 Token 级 SSE 流式传输
- **侧边栏升级**：
    - 新增"创建用户智能体"按钮
    - "回到上一个会话"按钮逻辑优化，准确恢复最近会话
- **流畅动画**：全局过渡动画统一调整为 200ms，优化主题切换体验

### 优化
- **对话体验**：
    - 修复了对话开始时出现"空气泡"和"双重气泡"的视觉问题
    - 移除了 AI 回复中意外出现的内部意图分类前缀（如 `general_chat`）
- **上下文管理**：修复了多轮对话中上下文传递和消息去重的问题
- **导航状态**：优化了侧边栏在不同页面（首页/对话/历史）下的高亮逻辑

### 修复
- 修复了流式输出时 JSON 解析可能导致的乱码问题
- 修复了从历史记录进入会话时侧边栏状态不正确的问题

---

## [v0.1.0] - 2026-01-15 (下午)

### 新增功能
- 实现流式输出效果（SSE 格式）
- 连续对话支持：发送消息后输入框保持 focus 状态
- 历史记录页面：按助手分组的卡片式展示
- 新增"当前对话"按钮，快速回到最近会话
- 四个功能按钮独立切换：首页/当前对话/历史记录/知识库
- 主题切换按钮颜色过渡动画

### 优化
- 侧边栏宽度从 100px 调整为 92px
- 头像大小调整为 40x40px 与功能按钮一致
- 移动端适配优化
- 历史记录重复问题修复
- 点击历史记录进入对话时自动选中"当前对话"按钮

### 修复
- 修复重复保存对话记录的问题
- 修复移动端头像不可见问题
- 修复弹出菜单被遮挡问题
- 修复主题切换闪烁问题

---

## [v0.0.5] - 2026-01-15 (上午)

### 新增功能
- 多智能体系统（8个 AI 助手）
- 响应式设计（移动端/平板/桌面）
- 深色模式支持
- 国际化（中/英/日）
- 流式打字效果

### 优化
- 前端/后端分离的 monorepo 架构
- 代码分割和性能优化
- 错误边界处理

---

## [v0.0.1] - 初始版本

### 新增功能
- 基础聊天功能
- LangGraph 工作流引擎
- 多模型支持（DeepSeek/OpenAI/Anthropic/Google）
