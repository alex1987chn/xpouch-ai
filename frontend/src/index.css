@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* ============================================
     BAUHAUS DESIGN SYSTEM v2.0
     Neo-Brutalism + Bauhaus Industrial
     ============================================ */

  /* Light mode - 魏玛纸张 */
  :root {
    /* 核心配色 - Bauhaus 风格 */
    --bg-page: #e8e8e3;
    --bg-card: #ffffff;
    --bg-panel: #f8f8f8;
    --border-color: #0f0f0f;
    --text-primary: #0f0f0f;
    --text-secondary: #555555;
    --text-muted: #888888;
    --text-inverted: #ffffff;
    --shadow-color: #0f0f0f;
    --accent-hover: #facc15;
    
    /* Bauhaus Design System - 映射到标准变量 */
    --bauhaus-bg: var(--bg-page);
    --bauhaus-card: var(--bg-card);
    --bauhaus-panel: var(--bg-panel);
    --bauhaus-border: var(--border-color);
    --bauhaus-text: var(--text-primary);
    --bauhaus-muted: var(--text-muted);
    --bauhaus-shadow: var(--shadow-color);
    --bauhaus-input-bg: var(--bg-card);
    --bauhaus-yellow: #facc15;
    --bauhaus-blue: #2563eb;
    --bauhaus-red: #ef4444;

    /* 网格和Logo */
    --grid-pattern: radial-gradient(#aaa 1.5px, transparent 1.5px);
    --logo-base: #2563eb;
    --logo-item: #facc15;
    --logo-item-active: #ef4444;

    /* Shadcn UI 兼容变量 */
    --background: 60 8% 90%;
    --foreground: 0 0% 6%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 6%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 6%;
    --primary: 0 0% 6%;
    --primary-foreground: 0 0% 98%;
    --secondary: 60 8% 90%;
    --secondary-foreground: 0 0% 6%;
    --muted: 60 8% 85%;
    --muted-foreground: 0 0% 33%;
    --accent: 48 96% 53%;
    --accent-foreground: 0 0% 6%;
    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 6%;
    --input: 0 0% 6%;
    --ring: 221 83% 53%;
    --radius: 0rem;
  }

  /* Dark mode - 德绍之夜 */
  html.dark,
  .dark {
    /* 核心配色 - Bauhaus 风格 */
    --bg-page: #0a0a0a;
    --bg-card: #1c1c1c;
    --bg-panel: #252525;
    --border-color: #e5e5e5;
    --text-primary: #f5f5f5;
    --text-secondary: #a0a0a0;
    --text-muted: #707070;
    --text-inverted: #0a0a0a;
    --shadow-color: #3b82f6;
    --accent-hover: #fbbf24;
    
    /* Bauhaus Design System - 映射到标准变量 */
    --bauhaus-bg: var(--bg-page);
    --bauhaus-card: var(--bg-card);
    --bauhaus-panel: var(--bg-panel);
    --bauhaus-border: var(--border-color);
    --bauhaus-text: var(--text-primary);
    --bauhaus-muted: var(--text-muted);
    --bauhaus-shadow: var(--shadow-color);
    --bauhaus-input-bg: var(--bg-card);
    --bauhaus-yellow: #fbbf24;
    --bauhaus-blue: #3b82f6;
    --bauhaus-red: #ef4444;

    /* 网格和Logo */
    --grid-pattern: radial-gradient(#333 1.5px, transparent 1.5px);
    --logo-base: #f0f0f0;
    --logo-item: #facc15;
    --logo-item-active: #2563eb;

    /* Shadcn UI 兼容变量 */
    --background: 0 0% 6%;
    --foreground: 0 0% 96%;
    --card: 0 0% 11%;
    --card-foreground: 0 0% 96%;
    --popover: 0 0% 11%;
    --popover-foreground: 0 0% 96%;
    --primary: 0 0% 96%;
    --primary-foreground: 0 0% 6%;
    --secondary: 0 0% 15%;
    --secondary-foreground: 0 0% 96%;
    --muted: 0 0% 15%;
    --muted-foreground: 0 0% 63%;
    --accent: 217 91% 60%;
    --accent-foreground: 0 0% 100%;
    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 100%;
    --border: 0 0% 85%;
    --input: 0 0% 85%;
    --ring: 217 91% 60%;
  }

  * {
    border-color: var(--border-color);
  }

  body {
    background-color: var(--bg-page);
    color: var(--text-primary);
    background-image: var(--grid-pattern);
    background-size: 32px 32px;
    font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  /* ============================================
     文本选择样式 - Bauhaus 高对比度风格
     ============================================ */
  
  /* 全局选择样式 */
  ::selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  ::-moz-selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  /* 用户消息选择样式 - 黄色高对比度 */
  .user-message ::selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  .user-message ::-moz-selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  /* AI 消息选择样式 - 黄色高对比度 */
  .ai-message ::selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  .ai-message ::-moz-selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  /* 输入框选择样式 */
  textarea::selection,
  input::selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  textarea::-moz-selection,
  input::-moz-selection {
    background-color: var(--accent-hover) !important;
    color: #000000 !important;
  }

  /* ============================================
     Placeholder 样式 - 提高对比度
     ============================================ */
  ::placeholder {
    color: var(--text-muted);
    opacity: 0.8;
  }

  .dark ::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
  }

  /* 输入框专用 placeholder */
  textarea::placeholder,
  input::placeholder {
    color: var(--text-muted);
    opacity: 0.9;
    font-style: italic;
  }

  .dark textarea::placeholder,
  .dark input::placeholder {
    color: var(--text-secondary);
    opacity: 0.8;
  }

  /* 字体配置 */
  .font-mono {
    font-family: 'Space Mono', monospace;
  }

  /* Bauhaus 全局样式 */
  h1, h2, h3, h4, h5, h6 {
    font-weight: 900;
    letter-spacing: -0.02em;
  }

  /* 移除默认圆角 - Bauhaus 风格 */
  button, input, textarea, select, [role="button"] {
    border-radius: 0 !important;
  }

  /* 主题切换按钮 - 圆形例外 */
  .theme-toggle-btn {
    border-radius: 9999px !important;
  }

  /* ============================================
     Bauhaus Scrollbar - 直角无圆角
     ============================================ */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--bg-page);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 0;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--shadow-color);
  }

  /* ============================================
     Bauhaus Core Components
     ============================================ */

  /* Bauhaus Border */
  .bauhaus-border {
    border: 2px solid var(--border-color);
  }

  /* Bauhaus Scrollbar - 直角无圆角，hover时才显示 */
  .bauhaus-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
  }

  .bauhaus-scrollbar::-webkit-scrollbar {
    width: 4px;
  }

  .bauhaus-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .bauhaus-scrollbar::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 0;
  }

  /* hover时显示滚动条 */
  .bauhaus-scrollbar:hover {
    scrollbar-color: var(--border-color) transparent;
  }

  .bauhaus-scrollbar:hover::-webkit-scrollbar-thumb {
    background: var(--border-color);
    opacity: 0.4;
  }

  .bauhaus-scrollbar:hover::-webkit-scrollbar-thumb:hover {
    background: var(--accent-hover);
    opacity: 1;
  }

  /* Dark mode */
  .dark .bauhaus-scrollbar {
    scrollbar-color: transparent transparent;
  }

  .dark .bauhaus-scrollbar::-webkit-scrollbar-thumb {
    background: transparent;
  }

  .dark .bauhaus-scrollbar:hover {
    scrollbar-color: var(--border-color) transparent;
  }

  .dark .bauhaus-scrollbar:hover::-webkit-scrollbar-thumb {
    background: var(--border-color);
    opacity: 0.6;
  }

  .dark .bauhaus-scrollbar:hover::-webkit-scrollbar-thumb:hover {
    background: var(--accent-hover);
  }

  /* Bauhaus Card - 核心卡片样式 */
  .bauhaus-card {
    border: 2px solid var(--border-color);
    background: var(--bg-card);
    box-shadow: var(--shadow-color) 6px 6px 0 0;
    transition: all 0.2s;
  }

  .bauhaus-card:hover {
    transform: translate(-3px, -3px);
    box-shadow: var(--accent-hover) 10px 10px 0 0;
    border-color: var(--accent-hover);
  }

  /* Bauhaus Button - 核心按钮样式 */
  .bauhaus-btn {
    border: 2px solid var(--border-color);
    background: var(--bg-card);
    color: var(--text-primary);
    box-shadow: var(--shadow-color) 4px 4px 0 0;
    font-weight: 700;
    transition: all 0.1s;
    letter-spacing: 0.05em;
  }

  .bauhaus-btn:hover {
    transform: translate(-2px, -2px);
    box-shadow: var(--accent-hover) 6px 6px 0 0;
    background: var(--accent-hover);
    color: #000;
    border-color: #000;
  }

  .bauhaus-btn:active {
    transform: translate(2px, 2px);
    box-shadow: none;
  }

  /* 噪点纹理覆盖 */
  .texture-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22 opacity=%220.05%22/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.6;
    mix-blend-mode: overlay;
  }

  /* 跑马灯动画 */
  .marquee-container {
    overflow: hidden;
    white-space: nowrap;
  }

  .marquee-content {
    display: inline-block;
    animation: marquee 20s linear infinite;
  }

  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* 输入框光标动画 */
  .blinking-cursor {
    display: inline-block;
    width: 10px;
    height: 24px;
    background: var(--accent-hover);
    animation: blink 1s step-end infinite;
    vertical-align: middle;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  /* Logo 动画 */
  .logo-wrapper {
    width: 42px;
    height: 42px;
    position: relative;
  }

  .pocket-base {
    width: 36px;
    height: 20px;
    border: 2px solid var(--border-color);
    border-top: none;
    background: var(--logo-base);
    border-bottom-left-radius: 18px;
    border-bottom-right-radius: 18px;
    position: absolute;
    bottom: 8px;
    left: 3px;
    z-index: 10;
    animation: baseRecoil 3s infinite cubic-bezier(0.25, 1, 0.5, 1);
  }

  .pocket-item {
    width: 16px;
    height: 16px;
    background: var(--logo-item);
    border: 2px solid var(--border-color);
    position: absolute;
    left: 13px;
    top: -10px;
    z-index: 5;
    animation: dropProcess 3s infinite cubic-bezier(0.68, -0.55, 0.27, 1.55);
  }

  @keyframes dropProcess {
    0% { top: -20px; opacity: 0; }
    20% { opacity: 1; }
    40% { top: 10px; background: var(--logo-item); }
    50% { top: 10px; transform: rotate(10deg); background: var(--logo-item-active); }
    60% { top: 10px; transform: rotate(-10deg); }
    80% { top: 10px; opacity: 1; transform: scale(1); }
    100% { top: 10px; opacity: 0; transform: scale(0); }
  }

  @keyframes baseRecoil {
    0%, 35% { transform: scale(1); }
    40% { transform: scaleY(0.8) scaleX(1.1); }
    50% { transform: scaleY(1.05) scaleX(0.95); }
    60% { transform: scale(1); }
    100% { transform: scale(1); }
  }

  /* ============================================
     Utility Classes
     ============================================ */
  .bg-page { background-color: var(--bg-page); }
  .bg-card { background-color: var(--bg-card); }
  .text-primary { color: var(--text-primary); }
  .text-secondary { color: var(--text-secondary); }
  .border-theme { border-color: var(--border-color); }

  /* ============================================
     Dark Mode Enhancements
     ============================================ */
  
  /* Prose content in dark mode */
  .dark .prose {
    --tw-prose-body: var(--text-primary);
    --tw-prose-headings: var(--text-primary);
    --tw-prose-lead: var(--text-secondary);
    --tw-prose-links: #60a5fa;
    --tw-prose-bold: var(--text-primary);
    --tw-prose-counters: var(--text-secondary);
    --tw-prose-bullets: var(--text-secondary);
    --tw-prose-hr: var(--border-color);
    --tw-prose-quotes: var(--text-secondary);
    --tw-prose-quote-borders: var(--border-color);
    --tw-prose-captions: var(--text-secondary);
    --tw-prose-code: var(--text-primary);
    --tw-prose-pre-code: #e2e8f0;
    --tw-prose-pre-bg: #1e293b;
    --tw-prose-th-borders: var(--border-color);
    --tw-prose-td-borders: var(--border-color);
  }

  .dark .prose-invert {
    --tw-prose-body: var(--text-primary);
    --tw-prose-headings: var(--text-primary);
  }

  /* Code highlighting in dark mode */
  .dark .hljs {
    background: #1e293b;
    color: #e2e8f0;
  }

  /* Scrollbar improvements for dark mode */
  .dark ::-webkit-scrollbar-track {
    background: var(--bg-page);
  }

  .dark ::-webkit-scrollbar-thumb {
    background: #444444;
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background: var(--accent-hover);
  }

  /* ============================================
     Performance Optimization
     ============================================ */
  @media (prefers-reduced-motion: no-preference) {
    * {
      animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}
